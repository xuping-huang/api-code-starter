{{#apiStyle.other.needJwt}}
const jwt = require('jsonwebtoken')
{{/apiStyle.other.needJwt}}
const { AuthenticateError } = require('../lib/app-error')
const config = require('../config/config')
{{#apiStyle.other.needJwt}}

/**
 * Return member info packaged at jwt sign
 * @param {object} req - the request info
 * @return {object} the user info
 */
const getUserInfoFromToken = (req) => {
  const auth = req.get(config.jwt.headerName)
  if (!auth) return Promise.reject(new AuthenticateError())

  const jwtObj = jwt.verify(auth.substr(7), config.jwt.secretKey)
  return Promise.resolve(jwtObj)
}
{{/apiStyle.other.needJwt}}

/**
 * Get integer hash value for string
 * @param {string} str - the string convert to hash number
 * @return {number} numeric hash value generated by strings
 */
const hashCode = (str) => {
  let hash = 0
  if (str.length === 0) return hash
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i)
    hash = ((hash << 5) - hash) + char
    hash = hash & hash // Convert to 32bit integer
  }
  return Math.abs(hash)
}

module.exports = {
  {{#apiStyle.other.needJwt}}
  getUserInfoFromToken,
  {{/apiStyle.other.needJwt}}
  hashCode
}
